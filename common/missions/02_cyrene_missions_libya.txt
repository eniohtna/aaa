cyrene_missions_libya = {
    header = "kush_mission_header"
    icon = "cde_greek_desert_march"

    repeatable = no
    chance = 1000

    potential = {
        NOT = { has_variable = mission_cooldown_var }
        primary_culture = libyan
        root = c:CYR
    }

    abort = {}
    on_start = {
        start_mission_ai_effect = yes
    }
    on_abort = {
        custom_tooltip = general_mission_cooldown_tt
        set_variable = {
            name = mission_cooldown_var
            days = 7300
        }
    }
    on_completion = {
    }

    cyrene_missions_libya_task_1 = { # The Spoils of Victory
        icon = "task_conquest"
        allow = {
            war = no
            custom_tooltip = {
                any_pantheon_deity = {
                    count >= 4
                    deity_religion = berber_religion
                }
                text = "only_amazigh_deities_tt"
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.1
            show_as_tooltip = {
                add_treasury = 250
                add_political_influence = 50
                add_country_modifier = {
                    name = spoils_of_war
                    duration = 365
                }
                p:3360 = {
                    add_province_modifier = {
                        name = we_be_losers
                        duration = 365
                    }
                }
                add_stability = 30
            }
        }
    }
    cyrene_missions_libya_task_2 = { # Foreign Customs
        icon = "task_diplomatic"
        duration = 30
        requires = { cyrene_missions_libya_task_1 }
        bypass = { has_completed_mission_task = cyrene_missions_libya_task_3 }
        allow = {
            custom_tooltip = {
                text = cyrene_1_libya_task_2.tt
                any_country_culture = {
                    is_culture = cyrenaican
                    OR = {
                        is_integrated = yes
                        has_country_culture_modifier = right_of_marriage
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.2
            show_as_tooltip = {
                change_law = coin_minting_law
                change_law = increased_council_powers
            }
        }
    }
    cyrene_missions_libya_task_3 = { # Return to Old Ways
        icon = "task_happiness"
        duration = 30
        requires = { cyrene_missions_libya_task_1 }
        bypass = { has_completed_mission_task = cyrene_missions_libya_task_2 }
        allow = {
            custom_tooltip = {
                text = cyrene_1_libya_task_3.tt
                any_country_culture = {
                    is_culture = cyrenaican
                    OR = {
                        has_pop_type_right = slaves
                        has_pop_type_right = tribesmen
                    }
                }
            }
            custom_tooltip = {
                text = cyrene_1_libya_task_3_B.tt
                any_owned_province = {
                    is_in_region = cyrenaica_region
                    OR = {
                        governor_policy = religious_conversion 
                        governor_policy = cultural_assimilation  
                    } 
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.3
            show_as_tooltip = {
                change_law = follow_the_strong_law
                change_law = tribal_decentralized_laws_2
                change_law = super_decentralized_law_two
            }
        }
    }
    cyrene_missions_libya_task_4 = { # The Capital at Barke
        icon = "task_economical"
        requires = { cyrene_missions_libya_task_2 cyrene_missions_libya_task_3 }
        highlight = {
            scope:province = capital_scope
        }
        allow = {
            p:3357 = {
                is_capital = yes
            }
            hidden:p:3357 = {
                calc_true_if = {
                    amount >= 2
                    has_building = population_building
                    has_building = commerce_building
                    has_building = town_hall_building
                    has_building = military_building
                }
            }
            hidden:p:3357 = {
                calc_true_if = {
                    amount >= 1
                    has_building = fortress_building
                    has_building = forum_building
                    has_building = aqueduct_building
                    has_building = foundry_building
                }
            }
            hidden:p:3357.state = {
                calc_true_if = {
                    amount >= 2
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.4
            show_as_tooltip = {
                p:3357 = {
                    add_province_modifier = {
                        name = capital_of_libu
                        duration = -1
                    }
                }
                add_2_free_province_investments = yes
                while = {
                    count = 10
                    every_owned_province = {
                        limit = {
                            province_id = 3357
                        }
                        random_pops_in_province = {
                            limit = {
                                NOT = {pop_culture = root.culture}
                            }
                            set_pop_culture = root.culture
                        }
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_5 = { # Recruit Hellenic Advisors
        icon = "task_heracles"
        requires = { cyrene_missions_libya_task_2 }
        prevented_by = { cyrene_missions_libya_task_3 }
        allow = {
            custom_tooltip = {
                text = "one_job_tt"
                exists = job_holder:office_arbitrator
                exists = job_holder:office_elder
                exists = job_holder:office_warchief
                exists = job_holder:office_bodyguard
                exists = job_holder:office_high_priest
                exists = job_holder:office_wise_person
                exists = job_holder:office_magistrate
                exists = job_holder:office_apothecary
            }
            custom_tooltip = {
                text = "one_job_tt_2"
                OR = {
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_arbitrator
                        }
                        job_holder:office_arbitrator = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_elder
                        }
                        job_holder:office_elder = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_warchief
                        }
                        job_holder:office_warchief = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_bodyguard
                        }
                        job_holder:office_bodyguard = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_high_priest
                        }
                        job_holder:office_high_priest = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_wise_person
                        }
                        job_holder:office_wise_person = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_magistrate
                        }
                        job_holder:office_magistrate = {
                            has_culture_group = hellenic
                        }
                    }
                    trigger_if = {
                        limit = {
                            exists = job_holder:office_apothecary
                        }
                        job_holder:office_apothecary = {
                            has_culture_group = hellenic
                        }
                    }                                          
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.5
            show_as_tooltip = {
                add_country_modifier = {
                    name = hellenic_advisors
                    duration = 1825
                }
                add_innovation = 1
            }
        }
    }
    cyrene_missions_libya_task_6 = { # Seek Common Ground
        icon = "task_apollo"
        duration = 180
        requires = { cyrene_missions_libya_task_5 }
        allow = {
            custom_tooltip = {
                any_pantheon_deity = {
                    count >= 1
                    deity_religion = roman_pantheon
                }
                text = "hellenic_libu_deity_tt"
            }
            invention = ruler_popularity_gain_inv_2
            treasury >= 75
            political_influence >= 25
        }
        on_start = {
            trigger_event = me_cyr_libya.600
        }
        on_completion = {
            trigger_event = me_cyr_libya.6
            show_as_tooltip = {
                custom_tooltip = special_event_tt
                custom_tooltip = barce_deity_tt
            }
        }
    }
    cyrene_missions_libya_task_7 = { # Hellenic Reconciliation
        icon = "task_atlas"
        requires = { cyrene_missions_libya_task_6 }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 3360
                    province_id = 3344
                }
            }
        }
        allow = {
            p:3360 = {
                is_state_capital = yes
                total_population >= 25

            }
            hidden:p:3360.state = {
                calc_true_if = {
                    amount >= 1
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
            p:3344 = {
                total_population >= 20
                has_building = commerce_building
                has_building = forum_building
            }
            hidden:p:3344.state = {
                calc_true_if = {
                    amount >= 1
                    state_improvement_military_trigger = yes
                    state_improvement_civic_trigger = yes
                    state_improvement_oratory_trigger = yes
                    state_improvement_religious_trigger = yes
                }
            }
            custom_tooltip = {
                current_ruler = {
                    any_friend = { has_culture_group = hellenic }
                }
                text = hellenic_friend_tt
            }
            # Maybe add greek pop happiness check ? need help from snowlet
        }
        on_completion = {
            trigger_event = me_cyr_libya.7
            show_as_tooltip = {
                add_4_free_province_investments = yes
                add_innovation = 2
                random_owned_province = {
                    limit = {
                        has_city_status = yes
                        province_dominant_culture_group = hellenic
                        is_in_area = cyrenaica_inferioris_area
                        NOT = { province_id = 3357 }
                    }
                    add_province_modifier = {
                        name = greek_reconciliation
                        duration = -1
                    }
                }
                random_owned_province = {
                    limit = {
                        has_city_status = yes
                        province_dominant_culture_group = hellenic
                        is_in_area = cyrenaica_superioris_area
                    }
                    add_province_modifier = {
                        name = greek_reconciliation
                        duration = -1
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_8 = { # Letters for the Libyan Tongue
        icon = "task_diplomatic"
        duration = 180
        requires = { cyrene_missions_libya_task_5 }
        allow = {
            political_influence >= 50
            treasury >= 100
        }
        on_start = {
            trigger_event = me_cyr_libya.8
        }
        on_completion = {
            trigger_event = me_cyr_libya.806
            custom_tooltip = libu_script_tt
        }
    }
    cyrene_missions_libya_task_9 = { # Kings of Eastern Libya
        icon = "task_political"
        requires = { cyrene_missions_libya_task_7 cyrene_missions_libya_task_8 }
        highlight = {
            scope:province = {
                any_pops_in_province = { pop_culture = libyan }
            }
        }
        allow = {
            centralization >= 50
        }
        on_completion = {
            trigger_event = me_cyr_libya.9
            show_as_tooltip = {
                change_government = aristocratic_monarchy
                add_country_modifier = {
                    name = king_of_libu
                    duration = -1
                }
                custom_tooltip = add_claims_east_libya
            }
        }
        final = yes
    }
    cyrene_missions_libya_task_10 = { # Plunder the Greek Cities
        icon = "task_artemis"
        requires = { cyrene_missions_libya_task_3 }
        prevented_by = { cyrene_missions_libya_task_2 }
        allow = {
            custom_tooltip = {
                text = owns_cities_greek_tt
                any_country = {
                    country_culture_group = hellenic
                    war_with = root
                    any_owned_province = {
                        controller = root
                        has_city_status = yes
                    }
                }
            }
            num_of_ships >= 15
        }
        on_completion = {
            trigger_event = me_cyr_libya.10
            set_variable = unlocked_slave_raiding
            show_as_tooltip = {
                custom_tooltip = slave_raiding_enabled_tt
                add_treasury = 500
                add_political_influence = 200
                add_legitimacy = legitimacy_huge
                current_ruler = {
                    add_popularity = 20
                    add_trait = cruel
                    add_martial = 2
                    add_zeal = 2
                    add_nickname = "the_terrible_libu"
                }
                create_unit = {
                    location = 2574
                    navy = yes
                    add_subunit = octere
                    add_subunit = hexere
                }
                custom_tooltip = "occupation_kill_tt"
                every_province = {
                    limit = {
                        controller = root
                        NOT = { owner = root }
                        has_city_status = yes
                    }
                    while = {
                        count = 10
                        random_pops_in_province = {
                            kill_pop = yes
                        }
                    }
                    destroy_building_effect = yes
                }
            }
        }
    }
    cyrene_missions_libya_task_11 = { # Entice Libyan Settlers
        icon = "task_calm"
        duration = 365
        requires = { cyrene_missions_libya_task_10 }
        allow = {
            p:3360 = {
                governor_policy = cultural_assimilation
            }
            p:3357 = {
                governor_policy = decentralize_pops
            }
            custom_tooltip = {
                text = "cyrenaican_colonia_tt"
                any_country_culture = {
                    is_culture = cyrenaican
                    has_country_culture_modifier = colonia_founded
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.11
            show_as_tooltip = {
                custom_tooltip = 10_pops_culture_convert_tt
                hidden_effect = {
                    every_province = {
                        limit = {
                            dominant_province_culture = cyrenaican
                            has_city_status = yes
                        }
                        while = {
                            count = 10
                            limit = {
                                any_pops_in_province = { pop_culture = cyrenaican }
                            }
                            random_pops_in_province = {
                                limit = {
                                    NOT = { pop_culture = libyan }
                                }
                                set_pop_culture = libyan
                            }
                        }
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_12 = { # Approach for Garamantes
        icon = "task_diplomatic"
        duration = 180
        requires = { cyrene_missions_libya_task_11 }
        highlight = {
            scope:province = {
                exists = c:GAR
                owner = c:GAR
            }
        }
        bypass = {
            c:GAR = { has_land = no }
        }
        allow = {
            war = no
            c:GAR = { war = no }
            c:GAR = {
                opinion = {
                    target = root 
                    value >= 50                
                }
            }
            c:GAR = {
                NOT = { alliance_with = root }
            }
            political_influence >= 50
        }
        on_completion = {
            trigger_event = me_cyr_libya.12
            show_as_tooltip = {
                custom_tooltip = meet_with_garamntes_tt
            }
        }
    }
    cyrene_missions_libya_task_13 = { # Camel War Parties
        icon = "task_battle"
        requires = { cyrene_missions_libya_task_10 }
        highlight = {
            scope:province = {
                trade_goods = camel
            }
        }
        allow = {
            OR = {
                custom_tooltip = {
                    text = camel_need_2_2_tt
                    hidden:capital_scope.state = {
                        trade_good_surplus = {
                            target = camel
                            value >= 2
                        }
                    }
                }
                custom_tooltip = {
                    text = camel_need_2_tt
                    any_owned_province = {
                        trade_goods = camel
                        num_goods_produced >= 2
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.13
            show_as_tooltip = {
                custom_tooltip = camel_breeding_program_tt
                add_country_modifier = {
                    name = war_camels
                    duration = -1
                }
                set_variable = libu_camel_program
            }
        }
    }
    cyrene_missions_libya_task_14 = { # Raid the Cities of the West
        icon = "task_conquest"
        requires = { cyrene_missions_libya_task_13 }
        allow = {
            custom_tooltip = {
                text = libu_raiders_tt
                OR = {
                    region:africa_region = {
                        any_region_province = {
                            count >= 1
                            OR = {
                                has_province_modifier = province_razed_ua
                                has_province_modifier = province_pillaged
                            }
                            dominant_province_culture = carthaginian
                        }
                    }
                region:cyrenaica_region = {
                        any_region_province = {
                            count >= 1
                            OR = {
                                has_province_modifier = province_razed_ua
                                has_province_modifier = province_pillaged
                            }
                            dominant_province_culture = carthaginian
                        }
                    }
                }
            }
        }
        on_completion = {
            trigger_event = me_cyr_libya.14
            show_as_tooltip = {
                add_country_modifier = {
                    name = raided_punic_city
                    duration = 1825
                }
                add_treasury = 200
                add_political_influence = 50
                add_innovation = 2
                custom_tooltip = punic_death_tt
                hidden_effect = {
                    every_province = {
                        limit = {
                            controller = root
                            NOT = { owner = root }
                        }
                        while = {
                            count = 3
                            random_pops_in_province = {
                                kill_pop = yes
                            }
                        }
                        destroy_building_effect = yes
                    }
                }
            }
        }
    }
    cyrene_missions_libya_task_15 = { # Terror from the Desert
        icon = "task_expansion"
        requires = { cyrene_missions_libya_task_14 }
        highlight = {
            scope:province = {
                OR = {
                    province_id = 5350
                    province_id = 8153
                    province_id = 8158
                    province_id = 5351
                    province_id = 6499
                    province_id = 5993
                }
            }
        }
        allow = {
            centralization <= -50
        }
        on_completion = {
            trigger_event = me_cyr_libya.15
            show_as_tooltip = {
                change_government = steppe_horde
                add_country_modifier = {
                    name = desert_horde
                    duration = -1
                }
                add_country_modifier = {
                    name = terror_from_the_desert
                    duration = -1
                }
            }
            set_variable = terror_of_desert_path
        }
        final = yes
    }
}